Create Database COMPROMISOS
GO

Use COMPROMISOS
GO

-- DROP DATABASE COMPROMISOS
-- GO

Create table TIPO_ACTIVIDAD
(
TACT_ID NUMERIC(2,0) NOT NULL,
TACT_NOMBRE VARCHAR(20) NOT NULL,
CONSTRAINT TACT_PK PRIMARY KEY (TACT_ID)
)
GO

Create table OFICINA
(
OFIC_ID NUMERIC(2,0) NOT NULL,
OFIC_NOMBRE VARCHAR(20) NOT NULL,
CONSTRAINT OFIC_PK PRIMARY KEY (OFIC_ID)
)
GO

Create Table UNIDAD_TRABAJO
(
UTRA_ID VARCHAR (6) NOT NULL,
UTRA_NOMBRE VARCHAR(60) NOT NULL,
UTRA_OFICINA NUMERIC(2,0) NOT NULL,
UTRA_REGISTRO_ACT VARCHAR(1) DEFAULT 'S' NOT NULL,
CONSTRAINT UTRA_PK PRIMARY KEY (UTRA_ID),
CONSTRAINT UTRA_REGISTRO_ACT_CHK CHECK (UTRA_REGISTRO_ACT IN ('S','N'))
)
GO

CREATE TABLE ROL
(
ROL_ID NUMERIC(1,0) NOT NULL,
ROL_NOMBRE VARCHAR(20) NOT NULL,
CONSTRAINT ROL_PK PRIMARY KEY (ROL_ID)
)
GO

CREATE TABLE FUNCIONARIO
(
FUNC_ID VARCHAR(20) NOT NULL,
FUNC_NOMBRE VARCHAR(80) NOT NULL,
FUNC_EMAIL VARCHAR(50) NOT NULL,
FUNC_ROL NUMERIC(1,0) NOT NULL,
FUNC_UTRABAJO VARCHAR(6) NOT NULL,
FUNC_ESJEFE VARCHAR(1) NOT NULL DEFAULT 'N',
FUNC_ULTIMA_CON DATETIME NULL,
FUNC_IP_CON VARCHAR(15) NULL,
FUNC_REGISTRO_ACT VARCHAR(1) NOT NULL DEFAULT 'S',
CONSTRAINT FUNC_PK PRIMARY KEY (FUNC_ID),
CONSTRAINT FUNC_ESJEFE_CHK CHECK (FUNC_ESJEFE IN ('S','N')),
CONSTRAINT FUNC_REGISTRO_ACT_CHK CHECK (FUNC_REGISTRO_ACT IN ('S','N'))
)
GO

CREATE TABLE ACTIVIDAD
(
ACTI_ID NUMERIC(6,0) NOT NULL,
ACTI_FECHA_REG DATETIME NOT NULL,
ACTI_TIPO NUMERIC(2,0) NOT NULL,
ACTI_MOTIVO VARCHAR(200) NOT NULL,
ACTI_DESARROLLO VARCHAR(3000) NOT NULL,
ACTI_REGISTRO_ACT VARCHAR(1)  DEFAULT 'S' NOT NULL,
CONSTRAINT ACTI_PK PRIMARY KEY (ACTI_ID),
CONSTRAINT ACTI_REGISTRO_ACT_CHK CHECK (ACTI_REGISTRO_ACT IN ('S', 'N'))
)
GO

CREATE TABLE ASISTENCIA
(
ASIS_ACTIVIDAD NUMERIC(6,0) NOT NULL,
ASIS_FUNCIONARIO VARCHAR(20) NOT NULL,
CONSTRAINT ASIS_PK PRIMARY KEY (ASIS_ACTIVIDAD, ASIS_FUNCIONARIO)
)
GO

CREATE TABLE PARTICIPANTE
(
PART_ID NUMERIC(6,0) NOT NULL,
PART_RUT VARCHAR(10) NOT NULL,
PART_NOMBRE VARCHAR(100) NOT NULL,
PART_FONO VARCHAR(12) NULL,
PART_EMAIL VARCHAR(80) NULL,
PART_INSTITUCION VARCHAR(80) NULL,
CONSTRAINT PART_PK PRIMARY KEY (PART_ID)
)
GO

CREATE TABLE REGISTRO
(
REGI_ACTIVIDAD NUMERIC(6,0) NOT NULL,
REGI_PARTICIPANTE NUMERIC(6,0) NOT NULL,
CONSTRAINT REGI_PK PRIMARY KEY (REGI_ACTIVIDAD, REGI_PARTICIPANTE)
)
GO

CREATE TABLE ESTADO
(
ESTA_ID NUMERIC(1,0) NOT NULL,
ESTA_NOMBRE varchar(20) NOT NULL,
CONSTRAINT ESTA_PK PRIMARY KEY (ESTA_ID)
)
GO

CREATE TABLE COMPROMISO
(
COMP_ID NUMERIC(8,0) NOT NULL,
COMP_TAREA varchar (500) NOT NULL,
COMP_PLAZO NUMERIC(3,0) NOT NULL,
COMP_FECHA_ASIG DATETIME NOT NULL,
COMP_ACTIVIDAD NUMERIC(6,0) NOT NULL,
COMP_FUNCIONARIO_RESP VARCHAR(20) NOT NULL,
COMP_ESTADO NUMERIC(1,0) NOT NULL DEFAULT '1',
CONSTRAINT COMP_PK PRIMARY KEY (COMP_ID)
)

CREATE TABLE RESPUESTA
(
RESP_ID NUMERIC(8,0) NOT NULL,
RESP_FECHA_REG DATETIME NOT NULL,
RESP_DETALLE VARCHAR(1000) NOT NULL,
CONSTRAINT RESP_PK PRIMARY KEY (RESP_ID)
)
GO

CREATE TABLE ARCHIVO
(
ARCH_CODIGO NUMERIC(10,0) NOT NULL,
ARCH_NOMBRE VARCHAR(80) NOT NULL,
ARCH_RESPUESTA NUMERIC(8,0) NOT NULL,
CONSTRAINT ARCH_PK PRIMARY KEY (ARCH_CODIGO)
)
GO

-- CREACION DE CLAVES FORANEAS

ALTER TABLE ACTIVIDAD
  ADD CONSTRAINT ACTI_TACT_FK FOREIGN KEY (ACTI_TIPO) REFERENCES TIPO_ACTIVIDAD(TACT_ID) 
GO

ALTER TABLE UNIDAD_TRABAJO
  ADD CONSTRAINT UTRA_OFIC_FK FOREIGN KEY (UTRA_OFICINA) REFERENCES OFICINA(OFIC_ID)
GO

ALTER TABLE FUNCIONARIO
  ADD CONSTRAINT FUNC_UTRA_FK FOREIGN KEY (FUNC_UTRABAJO) REFERENCES UNIDAD_TRABAJO(UTRA_ID),
  CONSTRAINT FUNC_ROL_FK FOREIGN KEY (FUNC_ROL) REFERENCES ROL(ROL_ID)
GO

ALTER TABLE ASISTENCIA
  ADD CONSTRAINT ASIS_ACTI_FK FOREIGN KEY (ASIS_ACTIVIDAD) REFERENCES ACTIVIDAD(ACTI_ID),
  CONSTRAINT ASIS_FUNC_FK FOREIGN KEY (ASIS_FUNCIONARIO) REFERENCES FUNCIONARIO(FUNC_ID)
GO

ALTER TABLE REGISTRO
  ADD CONSTRAINT REGI_ACTI_FK FOREIGN KEY (REGI_ACTIVIDAD) REFERENCES ACTIVIDAD(ACTI_ID),
  CONSTRAINT REGI_PART_FK FOREIGN KEY (REGI_PARTICIPANTE) REFERENCES PARTICIPANTE(PART_ID)
  GO

ALTER TABLE COMPROMISO
  ADD CONSTRAINT COMP_ACTI_FK FOREIGN KEY (COMP_ACTIVIDAD) REFERENCES ACTIVIDAD(ACTI_ID),
  CONSTRAINT COMP_FUNC_FK FOREIGN KEY (COMP_FUNCIONARIO_RESP) REFERENCES FUNCIONARIO(FUNC_ID),
  CONSTRAINT COMP_ESTA_FK FOREIGN KEY (COMP_ESTADO) REFERENCES ESTADO(ESTA_ID)
GO

ALTER TABLE RESPUESTA
  ADD CONSTRAINT RESP_COMP_FK FOREIGN KEY (RESP_ID) REFERENCES COMPROMISO(COMP_ID)
GO

ALTER TABLE ARCHIVO
  ADD CONSTRAINT ARCH_RESP_FK FOREIGN KEY(ARCH_RESPUESTA) REFERENCES RESPUESTA(RESP_ID)
GO
